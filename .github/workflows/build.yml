name: Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-windows:
    runs-on: windows-2022  # windows-2019 retirado en 2025-06-30

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup MSBuild (VS 2022)
        uses: microsoft/setup-msbuild@v2
        with:
          msbuild-architecture: x64

      - name: Setup NuGet
        uses: NuGet/setup-nuget@v2

      - name: Detect solution under src/
        id: find_sln
        shell: pwsh
        run: |
          $sln = Get-ChildItem -Path "src" -Filter *.sln -Recurse | Select-Object -First 1
          if (-not $sln) { Write-Error "No se encontró ninguna .sln bajo 'src/'"; exit 1 }
          "SLN_PATH=$($sln.FullName)" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          Write-Host "Solución detectada: $($sln.FullName)"

      # Crea App.config temporal si falta (NO se sube; solo en el runner)
      - name: Create temporary App.config if missing
        shell: pwsh
        run: |
          $csprojs = Get-ChildItem -Path "src" -Filter *.csproj -Recurse
          foreach ($p in $csprojs) {
            $projDir  = Split-Path